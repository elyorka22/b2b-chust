# Настройка Supabase Storage для изображений товаров

## Проблема
Изображения товаров не загружаются в Supabase Storage, потому что bucket `product-images` не существует.

## Решение: Создание bucket вручную

### Шаг 1: Откройте Supabase Dashboard
1. Зайдите на [supabase.com](https://supabase.com)
2. Войдите в свой проект
3. Перейдите в раздел **Storage** в боковом меню

### Шаг 2: Создайте новый bucket
1. Нажмите кнопку **"New bucket"** или **"Create bucket"**
2. Введите имя bucket: `product-images`
3. Выберите настройки:
   - **Public bucket**: ✅ Включено (чтобы изображения были доступны публично)
   - **File size limit**: 5 MB (или больше, если нужно)
   - **Allowed MIME types**: 
     - `image/jpeg`
     - `image/png`
     - `image/webp`
     - `image/gif`
4. Нажмите **"Create bucket"**

### Шаг 3: Настройте политики доступа (опционально)
Если bucket создан как публичный, дополнительные политики не требуются. Но если нужно ограничить доступ:

1. Перейдите в **Storage** → **Policies**
2. Создайте политику для bucket `product-images`:
   - **Policy name**: "Allow public read access"
   - **Allowed operation**: SELECT
   - **Policy definition**: 
     ```sql
     bucket_id = 'product-images'
     ```

### Шаг 4: Проверьте переменные окружения
Убедитесь, что в вашем проекте установлены следующие переменные окружения:

```env
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
```

### Шаг 5: Перезапустите приложение
После создания bucket и настройки переменных окружения перезапустите приложение.

## Альтернатива: Локальное хранилище

Если вы не хотите использовать Supabase Storage, приложение автоматически будет сохранять изображения локально в папку `public/uploads`. Убедитесь, что:

1. Папка `public/uploads` существует
2. У приложения есть права на запись в эту папку
3. Файлы доступны через статический путь `/uploads/filename.jpg`

## Проверка работы

После настройки:
1. Попробуйте загрузить изображение товара через админ-панель
2. Проверьте в Supabase Dashboard → Storage → `product-images`, что файл появился
3. Проверьте, что изображение отображается на карточке товара

## Troubleshooting

### Изображения не отображаются
- Проверьте, что bucket создан и является публичным
- Проверьте URL изображения в базе данных
- Убедитесь, что переменные окружения установлены правильно

### Ошибка 500 при загрузке
- Проверьте логи сервера для деталей ошибки
- Убедитесь, что `SUPABASE_SERVICE_ROLE_KEY` установлен правильно
- Проверьте права доступа к bucket

### Bucket не создается автоматически
- Создайте bucket вручную через Supabase Dashboard
- Или используйте локальное хранилище (fallback работает автоматически)

